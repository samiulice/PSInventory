<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Statement</title>
    
</head>
<body>
   <button onclick="generatePDF()">Generate PDF</button>
   <script>
    function generatePDF() {
      let n = reportData.length;
      let tBody = '';
      total_stock_qty = 0;
      total_purchase_qty = 0;
      total_purchase_price = 0;
      total_sale_qty = 0;
      total_sale_price = 0;

      if (n > 0) {
        const p = reportData[0];
        let purchase_rate = "-", sale_rate = "-";
        if (p.quantity_purchased != 0) {
          let prate = p.purchase_cost / p.quantity_purchased;
          purchase_rate = `${prate.toFixed(2)}`
        }
        if (p.quantity_sold != 0) {
          let rate = p.sold_price / p.quantity_sold;
          sale_rate = `${rate.toFixed(2)}`
        }
        total_stock_qty += p.quantity_in_stock;
        total_purchase_qty += p.quantity_purchased;
        total_purchase_price += p.purchase_cost;
        total_sale_qty += p.quantity_sold;
        total_sale_price += p.sold_price;
        tBody += `
          <tr>
            <th colspan=9 style="background-color:rgba(9, 121, 105,0.1); color:black;text-align: left;">${p.category_id}</th>
          </tr>
          <tr>
            <td>${p.product_code || "-"}</td>
            <td style="text-align: left;">${p.product_name || "-"}</td>
            <td>${p.quantity_in_stock}</td>
            <td>${p.quantity_purchased}</td>
            <td>${purchase_rate}</td>
            <td>${p.purchase_cost}</td>
            <td>${p.quantity_sold}</td>
            <td>${sale_rate}</td>
            <td>${p.sold_price}</td>
          </tr>
          `
        for (let i = 1; i < n; i++) {
          if (reportData[i - 1].category_id !== reportData[i].category_id) {
            tBody += `<tr><th colspan=9 style="background-color:rgba(9, 121, 105,0.1); color:black;text-align: left;">${reportData[i].category_id}</th></tr>`
          }
          const p = reportData[i];
          let purchase_rate = "-", sale_rate = "-";
          if (p.quantity_purchased != 0) {
            let prate = p.purchase_cost / p.quantity_purchased;
            purchase_rate = `${prate.toFixed(2)}`
          }
          if (p.quantity_sold != 0) {
            let rate = p.sold_price / p.quantity_sold;
            sale_rate = `${rate.toFixed(2)}`
          }
          total_stock_qty += p.quantity_in_stock;
          total_purchase_qty += p.quantity_purchased;
          total_purchase_price += p.purchase_cost;
          total_sale_qty += p.quantity_sold;
          total_sale_price += p.sold_price;
          tBody += `
            <tr>
              <td>${p.product_code || "-"}</td>
              <td style="text-align: left;">${p.product_name || "-"}</td>
              <td>${p.quantity_in_stock}</td>
              <td>${p.quantity_purchased}</td>
              <td>${purchase_rate}</td>
              <td>${p.purchase_cost}</td>
              <td>${p.quantity_sold}</td>
              <td>${sale_rate}</td>
              <td>${p.sold_price}</td>
            </tr>
          `;
        }
        tBody += `
          <tr>
            <th style="text-align:left" colspan=2>Total</th>
            <th style="text-align:right">${total_stock_qty}</th>
            <th style="text-align:right">${total_purchase_qty}</th>
            <th colspan=2>${total_purchase_price}</th>
            <th style="text-align:right">${total_sale_qty}</th>
            <th style="text-align:right" colspan=2>${total_sale_price}</th>
          </tr>
          `
      } else {
        tBody = `
          <tr><td colspan="9" style="text-align:center;">No data available</td></tr>`;
      }

      const content = `
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8">
          <title>Company Report</title>
          <link rel="stylesheet" type="text/css" href="styles.css">
          <style>
              /* Header styling */
            .header {
              text-align: center;
              margin-bottom: 20px;
              padding: 10px;
              border-bottom: 2px solid #008080;
            }
            .header h1 {
              font-size: 28px;
              color: #008080;
              font-weight: bold;
              margin: 0;
              text-transform: uppercase;
            }
            .header h2 {
              font-size: 16px;
              color: #444;
              margin: 5px 0 15px 0;
              font-style: italic;
              font-weight: normal;
            }
            .header p {
              margin: 3px 0;
              font-size: 14px;
              color: #666;
            }
            
            /* table caption and printing date section */
            .caption-section {
              display: flex;
              justify-content: space-between;
              align-items: center;
              font-size: 18px;
              color: #444;
              padding-top: 10px;
            }
            .caption-section .caption {
              font-weight: bold;
              color: #008080;
            }
            .caption-section .print-date {
              font-style: italic;
              color: #666;
            }

            /* Table styling */
            table {
              width: 100%;
              border-collapse: collapse;
              font-family: Arial, sans-serif;
            }
            th, td {
              padding: 5px;
              font-size: 10px;
              text-align: right;
              border: 0.1em solid rgba(0, 0, 0, 0.25);
            }
            th {
              background-color: #008080;
              color: white;
              text-align: center;
            }            

            /* Footer styling */
            .footer {
              position: fixed;
              bottom: 0;
              width: 100%;
              text-align: center;
              font-size: 12px;
              color: #666;
              padding: 10px 0;
            }
            .footer .page-number:after {
              content: counter(page);
            }
          </style>
        </head>
        <body>
          <!-- Header Section -->
          <div class="header">
            ${reportData.company ? `
              <h1>${reportData.company.name || ""}</h1>
              <h2>${reportData.company.slogan || ""}</h2>
              <p>${reportData.company.address || ""}</p>
              <p>Mobile: ${reportData.company.mobile || ""} | Email: ${reportData.company.email || ""}</p>
            ` : `
              <h1>ProjuktiSheba Inventory</h1>
              <h2>Track Smarter, Stock Better</h2>
              <p>Teri Bazar, Netrakona Shadar, Netrakona, Mymensingh</p>
              <p>Mobile: +8801742135093 | Email: psi@projuktisheba.com</p>
            `}
            
            <!-- Line with Caption and Print Date -->
            <div class="caption-section">
              <div class="caption">Stock Report</div>
              <div class="print-date">Printed on: ${getShortDate()}</div>
            </div>
          </div>

          <!-- Table Section -->
          <table>
            <thead>
              <tr>
                <th>Code</th>
                <th>Name</th>
                <th>Stock</th>
                <th>Purchase Qty</th>
                <th>Purchase Rate</th>
                <th>Total Purchase Cost</th>
                <th>Sale Qty</th>
                <th>Sale Rate</th>
                <th>Total Sale Price</th>
              </tr>
            </thead>
            <tbody>
              ${tBody}
            </tbody>
          </table>
        </body>
        </html>
      `;

      // Create an iframe to load the content
      const iframe = document.createElement('iframe');
      document.body.appendChild(iframe);
      iframe.style.display = 'none';
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(content);
      doc.close();

      // Wait for content to load and then print
      iframe.onload = () => {
        iframe.contentWindow.print();
        document.body.removeChild(iframe);
      };
    }

  
   </script>
</body>
</html>
